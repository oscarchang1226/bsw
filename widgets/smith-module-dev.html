<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>Test</title>
        <link rel="stylesheet" href="./smith-module.css" />
        <link href="https://fonts.googleapis.com/css?family=Lato:400,700" rel="stylesheet">
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    </head>
    <body>
        <header>
            <div class="home_button" onClick="traverseToRoot()">
                <img src="./assets/home.svg" />
            </div>
            <h2>Home</h2>
        </header>
        <main>
            <div class="description">

            </div>
            <ul>

            </ul>
        </main>

        <script>
            let toc = {
                "Modules":[{"ModuleId":1206,"Title":"Smith\'s Ecosystem","Modules":[],"Topics":[{"TopicId":1207,"Identifier":"1207","TypeIdentifier":"File","Title":"The Smith Ecosystem vs. The Supply Chain","Bookmarked":false,"Unread":false,"Url":"/content/enforced/6666-TR102_MC_EN/The Smith Ecosystem vs. The Supply Chain.html"},{"TopicId":1208,"Identifier":"1208","TypeIdentifier":"File","Title":"Overview of Smith\'s Ecosystem & Competitors","Bookmarked":false,"Unread":true,"Url":"/content/enforced/6666-TR102_MC_EN/Overview of Smith\'s Ecosystem & Competitors.html"}]},{"ModuleId":1209,"Title":"The Supply Chain Players","Modules":[],"Topics":[{"TopicId":1210,"Identifier":"1210","TypeIdentifier":"File","Title":"Map of the Semiconductor Supply Chain","Bookmarked":false,"Unread":false,"Url":"/content/enforced/6666-TR102_MC_EN/SmithU Flowchart8.png"},{"TopicId":2455,"Identifier":"2455","TypeIdentifier":"File","Title":"Original Equipment Manufacturers","Bookmarked":false,"Unread":false,"Url":"/content/enforced/6666-TR102_MC_EN/Original Equipment Manufacturers.html"},{"TopicId":2448,"Identifier":"2448","TypeIdentifier":"File","Title":"Original Design Manufacturers (ODM & JDM)","Bookmarked":false,"Unread":false,"Url":"/content/enforced/6666-TR102_MC_EN/Original Design Manufacturers (ODM & JDM).html"},{"TopicId":2456,"Identifier":"2456","TypeIdentifier":"File","Title":"Contract Electronics Maufacturers (CEM, CM, & EMS)","Bookmarked":false,"Unread":true,"Url":"/content/enforced/6666-TR102_MC_EN/Contract Electronics Maufacturers (CEM, CM, & EMS).html"},{"TopicId":2459,"Identifier":"2459","TypeIdentifier":"File","Title":"Chip & Component Manufacturers","Bookmarked":false,"Unread":true,"Url":"/content/enforced/6666-TR102_MC_EN/Chip & Component Manufacturers.html"},{"TopicId":2458,"Identifier":"2458","TypeIdentifier":"File","Title":"Broad Line Distributors","Bookmarked":false,"Unread":true,"Url":"/content/enforced/6666-TR102_MC_EN/Broad Line Distributors.html"},{"TopicId":2457,"Identifier":"2457","TypeIdentifier":"File","Title":"Franchised Distributors","Bookmarked":false,"Unread":true,"Url":"/content/enforced/6666-TR102_MC_EN/Franchised Distributors.html"},{"TopicId":1214,"Identifier":"1214","TypeIdentifier":"File","Title":"Independent Distributors","Bookmarked":false,"Unread":true,"Url":"/content/enforced/6666-TR102_MC_EN/Independent Distributors.html"},{"TopicId":1216,"Identifier":"1216","TypeIdentifier":"File","Title":"Build To Order Manufacturers (BTO)","Bookmarked":false,"Unread":true,"Url":"/content/enforced/6666-TR102_MC_EN/Build To Order Manufacturers (BTO).html"},{"TopicId":1217,"Identifier":"1217","TypeIdentifier":"File","Title":"Value Added Reseller (VAR)","Bookmarked":false,"Unread":true,"Url":"/content/enforced/6666-TR102_MC_EN/Value Added Reseller (VAR).html"}]},{"ModuleId":2449,"Title":"Bonus: How are chips made?","Modules":[],"Topics":[{"TopicId":2335,"Identifier":"2335","TypeIdentifier":"File","Title":"How are chips made? The simplified story","Bookmarked":false,"Unread":true,"Url":"/content/enforced/6666-TR102_MC_EN/How are chips made The simplified story.html"},{"TopicId":2843,"Identifier":"2843","TypeIdentifier":"File","Title":"Quick Bonus Quiz: Chip Manufacturing","Bookmarked":false,"Unread":true,"Url":"/content/enforced/6666-TR102_MC_EN/interactive-assessment-files/bonus-quiz.html"}]},{"ModuleId":3252,"Title":"Supply Chain Challenge!","Modules":[],"Topics":[{"TopicId":3253,"Identifier":"3253","TypeIdentifier":"File","Title":"Who\'s Who in Chiplandia?","Bookmarked":false,"Unread":true,"Url":"/content/enforced/6666-TR102_MC_EN/activityAssets/3bf049ef-3d9f-5f35-4363-d6ebc90378d5--activity.html"},{"TopicId":3254,"Identifier":"3254","TypeIdentifier":"File","Title":"Chiplandia\'s Neighborhood Sourcing","Bookmarked":false,"Unread":true,"Url":"/content/enforced/6666-TR102_MC_EN/activityAssets/bcf34f74-4e8b-5d71-f5c0-16b0f4c68765--activity.html"},{"TopicId":3255,"Identifier":"3255","TypeIdentifier":"File","Title":"Chiplandia SOS!","Bookmarked":false,"Unread":true,"Url":"/content/enforced/6666-TR102_MC_EN/activityAssets/c5fd7c3f-875a-71ec-6ff1-13543cd36a6e--activity.html"},{"TopicId":3256,"Identifier":"3256","TypeIdentifier":"File","Title":"Supply Chain Challenge!","Bookmarked":false,"Unread":true,"Url":"/content/enforced/6666-TR102_MC_EN/activityAssets/1a745720-0d1b-b9fb-478a-6171f42709cb--map.html"}]},{"ModuleId":1222,"Title":"Final Assignment: Showcase a Supply Chain","Modules":[{"ModuleId":2450,"Title":"Video Examples of Student Presentations for \"Create a Supply Chain\"","Modules":[],"Topics":[{"TopicId":2451,"Identifier":"2451","TypeIdentifier":"Link","Title":"Student Submission Example: Team Apple\'s Final Assignment","Bookmarked":false,"Unread":true,"Url":"Capture:33"},{"TopicId":2452,"Identifier":"2452","TypeIdentifier":"Link","Title":"Student Submission Example: Team Samsung\'s Final Assignment","Bookmarked":false,"Unread":true,"Url":"Capture:34"},{"TopicId":2453,"Identifier":"2453","TypeIdentifier":"Link","Title":"Student Submission Example: Team Dell\'s Final Assignment","Bookmarked":false,"Unread":true,"Url":"Capture:35"}]},{"ModuleId":2461,"Title":"Critique of Team Apple & Team Dell\'s Student Presentations","Modules":[],"Topics":[{"TopicId":2463,"Identifier":"2463","TypeIdentifier":"Link","Title":"TR102: Team Apple Feedback","Bookmarked":false,"Unread":true,"Url":"Capture:45"},{"TopicId":2464,"Identifier":"2464","TypeIdentifier":"Link","Title":"TR102: Team Dell Feedback","Bookmarked":false,"Unread":true,"Url":"Capture:46"}]}],"Topics":[{"TopicId":2454,"Identifier":"2454","TypeIdentifier":"Link","Title":"Submission for \"Create a Supply Chain\" Final Assignment","Bookmarked":false,"Unread":true,"Url":"/d2l/common/dialogs/quickLink/quickLink.d2l?ou=6666&type=dropbox&rcode=smith-734"}]},{"ModuleId":2597,"Title":"Lisa\'s D2L Example: East Onionham","Modules":[],"Topics":[{"TopicId":2598,"Identifier":"2598","TypeIdentifier":"File","Title":"Demo","Bookmarked":false,"Unread":true,"Url":"/content/enforced/6666-TR102_MC_EN/activityAssets/7a0182e6-0b5f-9edf-d8c5-367f06b11e8e--activity.html"},{"TopicId":2599,"Identifier":"2599","TypeIdentifier":"File","Title":"D2L QA","Bookmarked":false,"Unread":true,"Url":"/content/enforced/6666-TR102_MC_EN/activityAssets/d51035f2-50c8-c134-86d5-9373ef76007f--activity.html"},{"TopicId":2600,"Identifier":"2600","TypeIdentifier":"File","Title":"East Onionham","Bookmarked":false,"Unread":true,"Url":"/content/enforced/6666-TR102_MC_EN/activityAssets/3525f631-5127-9468-b8f8-c435a090252a--map.html"}]},{"ModuleId":2832,"Title":"Oscar\'s Practice Module","Modules":[],"Topics":[{"TopicId":3443,"Identifier":"3443","TypeIdentifier":"File","Title":"Start Here!","Bookmarked":false,"Unread":false,"Url":"/content/enforced/6666-TR102_MC_EN/interactive-assessment-files/Description.html"},{"TopicId":2846,"Identifier":"2846","TypeIdentifier":"File","Title":"Quick Quiz: Chip Manufacturing & Smith\'s Ecosystem","Bookmarked":false,"Unread":false,"Url":"/content/enforced/6666-TR102_MC_EN/interactive-assessment-files/bonus-quiz.html"},{"TopicId":2836,"Identifier":"2836","TypeIdentifier":"Link","Title":"Quick Quiz: Chip Manufacturing & Smith\'s Ecosystem","Bookmarked":false,"Unread":true,"Url":"/d2l/common/dialogs/quickLink/quickLink.d2l?ou=6666&type=quiz&rCode=smith-728"},{"TopicId":2838,"Identifier":"2838","TypeIdentifier":"File","Title":"Quiz: Bonus Chips","Bookmarked":false,"Unread":false,"Url":"/content/enforced/6666-TR102_MC_EN/Quiz Bonus Chips.html"},{"TopicId":3298,"Identifier":"3298","TypeIdentifier":"Link","Title":"Excel 2016: Functions","Bookmarked":false,"Unread":false,"Url":"http://www.youtube.com/watch?v=-9d4m79twdA"}]}]}
            let descriptionDummy = {"Text":"Smith is a player in an electronics ecosystem. That means...\n","Html":"<p>Smith is a player in an electronics ecosystem. That means...</p>\n<p></p>"};
            let structureDummy = [{"Id":1207,"Title":"The Smith Ecosystem vs. The Supply Chain","ShortTitle":"","Type":1},{"Id":1208,"Title":"Overview of Smith's Ecosystem & Competitors","ShortTitle":"","Type":1}];
            let assetSource = {
                image: './assets/file-image.svg',
                quiz: './assets/quizzing.svg',
                video: './assets/file-video.svg',
                browser: './assets/browser.svg'
            };
            let endPoints = {
                origin: 'https://smithweb.brightspace.com',
                toc: (orgId) => `/d2l/api/le/1.5/${orgId}/content/toc`,
                topic: (orgId, topId) => `/d2l/api/le/1.10/${orgId}/content/topics/${topId}`,
                module: (orgId, modId) => `/d2l/api/le/1.10/${orgId}/content/modules/${modId}`
            }
            toc.Modules.map((module) => {
                module.Description = descriptionDummy;
                module.Structure = structureDummy;
                return module;
            });
            let parentModule = toc;

            function traverseToRoot() {
                parentModule = toc;
                repopulate(parentModule);
            }

            function predictType(topic) {
                let result = assetSource.browser;
                if(topic.TypeIdentifier === 'File') {
                    if(topic.Url.endsWith('.gif') ||
                        topic.Url.endsWith('.jpg') ||
                        topic.Url.endsWith('.jpeg') ||
                        topic.Url.endsWith('.png')) {
                            result = assetSource.image;
                        }
                } else if(topic.TypeIdentifier === 'Link') {
                    if(topic.Url.indexOf('type=quiz') > -1) {
                        result = assetSource.quiz;
                    } else if(topic.Url.indexOf('youtube.com') > -1) {
                        result = assetSource.video;
                    }
                }
                return result;
            }

            function generateTopicList(topics) {
                if(!topics) return '';
                let temp = topics.map(t => generateTopic(t));
                return temp.join('');
            }

            function generateTopic(topic) {
                let iconUrl = predictType(topic);
                let classNames = 'topic';
                if(topic.Unread) {
                    classNames = 'topic unread';
                }
                return `
                    <li onClick="topicClick(this)" class="${classNames}">
                        <input type="hidden" name="url" value=${topic.url} />
                        <img src="${iconUrl}" />
                        <span>${topic.Title}</span>
                    </li>
                `;
            }

            function generateModuleList(modules) {
                if(!modules) return '';
                let temp = modules.map(m => generateModule(m));
                return temp.join('');
            }

            function generateModule(module) {
                return `
                    <li onClick="moduleClick(this)" class="module">
                        <input type="hidden" name="moduleId" value=${module.ModuleId} />
                        <img src="./assets/module.gif" />
                        <span>${module.Title}</span>
                    </li>
                `;
            }

            function setDescription(module) {
                let descriptionTag = $('div.description');
                if(!module.Description) {
                    descriptionTag.html('');
                    return;
                }
                let temp = module.Description.Html;
                temp = temp.replace(/\\n/g, '<br />');
                descriptionTag.html(temp);
            }

            function repopulate(p, showHome=false) {
                let ml = generateModuleList(p.Modules);
                let tl = generateTopicList(p.Topics);
                $('h2').html(p.Title || 'Home');
                $('ul').html(ml + tl);
                setDescription(p);
                let homeButton = $('div.home_button');
                if(showHome) {
                    homeButton.show();
                } else {
                    homeButton.hide();
                }
            }

            function moduleClick(li) {
                let moduleId = $(li).find('input[name="moduleId"]').val();
                parentModule = parentModule.Modules.find((m) => m.ModuleId == moduleId);
                repopulate(parentModule, true);
            }

            function topicClick(li) {
                let url = $(li).find('input[name="url"]').val();
                console.log(url);
            }

            function getOrgUnitContent(orgId) {
                let url = endpoints.origin+endPoints.toc(orgId);
                $.get(url, d => {
                    toc = d;
                    console.log('TOC loaded');
                });
            }

            function getModuleInfo(orgId, modId) {
                let url = endpoints.origin+endpoints.module(orhId, modId);
                $.get(url, d => {
                    let temp = d;
                    console.log('Module loaded');
                });
            }

            repopulate(parentModule);

        </script>
    </body>
</html>
